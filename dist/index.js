"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const t=require("vue");const T="data-bottom-sheet-stop",y={type:Boolean,default:!1},H={threshold:{type:Number,default:100},onlyHeaderSwipe:y,noStretch:y,noClickOutside:y,noHeader:y},P=Symbol("BottomSheet");function Y(){const o=t.ref(-1);let i=0;const r={activeSheet:o,id:()=>++i};return{install(m){m.provide(P,r)}}}function x(){return t.inject(P)}function N(o,i){return t.withModifiers(o,i)}const O=t.defineComponent({name:"SheetRenderer",props:{...H,id:{type:Number,required:!0}},emits:{updateElement:null,close:null},setup(o,{emit:i,slots:r}){const m=x(),n=t.ref(null),S=t.ref(null);t.onUnmounted(()=>i("updateElement",null));let h=!0;const b=N(()=>{o.noClickOutside||!h||i("close")},["self"]),v=t.ref(!1),s=t.ref(0),a=t.ref(0);let u=!1,c=0,d;function f(){c=n.value.getBoundingClientRect().height}function M(){var e,l;(e=n.value)==null||e.style.removeProperty("height"),(l=n.value)==null||l.style.removeProperty("max-height"),c=0,v.value=!1,s.value=0,a.value=0}function w(e){if(!u)return;let l;if("touches"in e?(l=e.touches[0].clientY,e.preventDefault()):l=e.clientY,l===a.value){v.value=!1;return}v.value=!0,s.value=l-a.value,h=!1,s.value<0&&!o.noStretch?(n.value.style.setProperty("height",`${c+Math.abs(s.value)}px`),n.value.style.setProperty("max-height","none")):(n.value.style.removeProperty("height"),n.value.style.removeProperty("max-height"))}function C(e){e.target instanceof HTMLElement&&e.target.closest(`[${T}]`)||("touches"in e?a.value=e.touches[0].clientY:a.value=e.clientY,u=!0)}function p(){!u||(s.value>=o.threshold?i("close"):setTimeout(()=>{var g;h=!0;const e=n.value?n.value.getBoundingClientRect().height:0,l=(g=n.value)==null?void 0:g.animate([{height:`${e}px`},{height:`${c}px`}],{duration:200,easing:"ease"});l==null||l.addEventListener("finish",()=>{n.value&&(n.value.style.removeProperty("height"),n.value.style.removeProperty("max-height"))})}),v.value=!1,a.value=0,s.value=0,u=!1)}function E(e){o.onlyHeaderSwipe&&C(e)}function k(e){o.onlyHeaderSwipe||C(e)}const B=[["resize",M],["resize",f],["mousemove",w],["mouseup",p],["touchend",p],["touchcancel",p],["touchmove",w,{passive:!1}]];return t.onMounted(()=>{d=new MutationObserver(f),d.observe(S.value,{childList:!0,subtree:!0}),f();for(const[e,l,g]of B)window.addEventListener(e,l,g)}),t.onUnmounted(()=>{for(const[e,l]of B)window.removeEventListener(e,l);d&&d.disconnect()}),()=>{var e;return t.createVNode("div",{class:"bottom-sheet-backdrop","data-sheet-active":o.id===m.activeSheet.value?"":null,draggable:!1,onClick:b,onMousedown:k,onTouchstart:k},[t.createVNode("div",{ref:n,class:"bottom-sheet","data-swiping":v.value?"":null,style:{transform:`translateY(${Math.max(s.value,0)}px)`}},[o.noHeader?null:t.createVNode("div",{onMousedown:E,onTouchstart:E,class:"bottom-sheet-header"},[r.header?r.header():t.createVNode("div",{class:"bottom-sheet-header-bar"},null)]),t.createVNode("div",{class:"bottom-sheet-body",ref:S},[(e=r.default)==null?void 0:e.call(r)])])])}}}),L=t.defineComponent({name:"Sheet",inheritAttrs:!1,props:{...H,visible:{type:Boolean,required:!0}},emits:{"update:visible":null},setup(o,{attrs:i,slots:r,emit:m}){const n=x(),S=n.id();let h=n.activeSheet.value;t.watch(()=>o.visible,a=>{a?(h=n.activeSheet.value,n.activeSheet.value=S):n.activeSheet.value=h},{immediate:!0});function b(){m("update:visible",!1)}function v(a,u){const c=a.querySelector(".bottom-sheet"),d=window.getComputedStyle(a).backgroundColor;a.animate([{backgroundColor:"rgba(0, 0, 0, 0)"},{backgroundColor:d}],{duration:300,easing:"ease"});const f=c.animate([{transform:"translateY(100%)"},{transform:"translateY(0%)"}],{duration:300,easing:"ease"});f.onfinish=u}function s(a,u){const c=a.querySelector(".bottom-sheet"),d=window.getComputedStyle(a).backgroundColor;a.animate([{backgroundColor:d},{backgroundColor:"rgba(0, 0, 0, 0)"}],{duration:300,easing:"ease"});const f=c.animate([{transform:"translateY(0%)"},{transform:"translateY(100%)"}],{duration:300,easing:"ease"});f.onfinish=u}return t.onUnmounted(()=>{n.activeSheet.value=h}),()=>t.createVNode(t.Teleport,{to:"body"},{default:()=>[t.createVNode(t.Transition,{css:!1,onEnter:v,onLeave:s},{default:()=>[o.visible&&t.createVNode(O,t.mergeProps({id:S,onClose:b},i,{noClickOutside:o.noClickOutside,noHeader:o.noHeader,noStretch:o.noStretch,onlyHeaderSwipe:o.onlyHeaderSwipe,threshold:o.threshold}),r)]})]})}});exports.Sheet=L;exports.createBottomSheet=Y;
