"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const t=require("vue");const x="data-bottom-sheet-stop",y={type:Boolean,default:!1},k={threshold:{type:Number,default:100},onlyHeaderSwipe:y,noStretch:y,noClickOutside:y,noHeader:y},H=Symbol("BottomSheet");function T(){const n=t.ref(-1);let i=0;const r={activeSheet:n,id:()=>++i};return{install(m){m.provide(H,r)}}}function P(){return t.inject(H)}function Y(n,i){return t.withModifiers(n,i)}const M=t.defineComponent({name:"SheetRenderer",props:{...k,id:{type:Number,required:!0}},emits:{updateElement:null,close:null},setup(n,{emit:i,slots:r}){const m=P(),o=t.ref(null);t.onUnmounted(()=>i("updateElement",null));let h=!0;const S=Y(()=>{n.noClickOutside||!h||i("close")},["self"]),d=t.ref(!1),s=t.ref(0),u=t.ref(0);let a=!1,c=0;function v(){c=o.value.getBoundingClientRect().height}function g(){var e,l;(e=o.value)==null||e.style.removeProperty("height"),(l=o.value)==null||l.style.removeProperty("max-height"),c=0,d.value=!1,s.value=0,u.value=0}function f(e){if(!a)return;let l;if("touches"in e?(l=e.touches[0].clientY,e.preventDefault()):l=e.clientY,l===u.value){d.value=!1;return}d.value=!0,s.value=l-u.value,h=!1,s.value<0&&!n.noStretch?(o.value.style.setProperty("height",`${c+Math.abs(s.value)}px`),o.value.style.setProperty("max-height","none")):(o.value.style.removeProperty("height"),o.value.style.removeProperty("max-height"))}function b(e){e.target instanceof HTMLElement&&e.target.closest(`[${x}]`)||("touches"in e?u.value=e.touches[0].clientY:u.value=e.clientY,a=!0)}function p(){!a||(s.value>=n.threshold?i("close"):setTimeout(()=>{var l;h=!0;const e=(l=o.value)==null?void 0:l.animate([{height:`${c}px`}],{duration:200,easing:"ease"});e==null||e.addEventListener("finish",()=>{o.value&&(o.value.style.removeProperty("height"),o.value.style.removeProperty("max-height"))})}),d.value=!1,u.value=0,s.value=0,a=!1)}function w(e){n.onlyHeaderSwipe&&b(e)}function C(e){n.onlyHeaderSwipe||b(e)}const E=[["resize",g],["resize",v],["mousemove",f],["mouseup",p],["touchend",p],["touchcancel",p],["touchmove",f,{passive:!1}]];return t.onMounted(()=>{v();for(const[e,l,B]of E)window.addEventListener(e,l,B)}),t.onUnmounted(()=>{for(const[e,l]of E)window.removeEventListener(e,l)}),()=>{var e;return t.createVNode("div",{class:"bottom-sheet-backdrop","data-sheet-active":n.id===m.activeSheet.value?"":null,draggable:!1,onClick:S,onMousedown:C,onTouchstart:C},[t.createVNode("div",{ref:o,class:"bottom-sheet","data-swiping":d.value?"":null,style:{transform:`translateY(${Math.max(s.value,0)}px)`}},[n.noHeader?null:t.createVNode("div",{onMousedown:w,onTouchstart:w,class:"bottom-sheet-header"},[r.header?r.header():t.createVNode("div",{class:"bottom-sheet-header-bar"},null)]),t.createVNode("div",{class:"bottom-sheet-body"},[(e=r.default)==null?void 0:e.call(r)])])])}}}),N=t.defineComponent({name:"Sheet",inheritAttrs:!1,props:{...k,visible:{type:Boolean,required:!0}},emits:{"update:visible":null},setup(n,{attrs:i,slots:r,emit:m}){const o=P(),h=o.id();let S=o.activeSheet.value;t.watch(()=>n.visible,a=>{a?(S=o.activeSheet.value,o.activeSheet.value=h):o.activeSheet.value=S},{immediate:!0});function d(){m("update:visible",!1)}function s(a,c){const v=a.querySelector(".bottom-sheet"),g=window.getComputedStyle(a).backgroundColor;a.animate([{backgroundColor:"rgba(0, 0, 0, 0)"},{backgroundColor:g}],{duration:300,easing:"ease"});const f=v.animate([{transform:"translateY(100%)"},{transform:"translateY(0%)"}],{duration:300,easing:"ease"});f.onfinish=c}function u(a,c){const v=a.querySelector(".bottom-sheet"),g=window.getComputedStyle(a).backgroundColor;a.animate([{backgroundColor:g},{backgroundColor:"rgba(0, 0, 0, 0)"}],{duration:300,easing:"ease"});const f=v.animate([{transform:"translateY(0%)"},{transform:"translateY(100%)"}],{duration:300,easing:"ease"});f.onfinish=c}return t.onUnmounted(()=>{o.activeSheet.value=S}),()=>t.createVNode(t.Teleport,{to:"body"},{default:()=>[t.createVNode(t.Transition,{css:!1,onEnter:s,onLeave:u},{default:()=>[n.visible&&t.createVNode(M,t.mergeProps({id:h,onClose:d},i,{noClickOutside:n.noClickOutside,noHeader:n.noHeader,noStretch:n.noStretch,onlyHeaderSwipe:n.onlyHeaderSwipe,threshold:n.threshold}),r)]})]})}});exports.Sheet=N;exports.createBottomSheet=T;
