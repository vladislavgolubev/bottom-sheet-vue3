"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const t=require("vue");const x="data-bottom-sheet-stop",p={type:Boolean,default:!1},B={threshold:{type:Number,default:100},onlyHeaderSwipe:p,noStretch:p,noClickOutside:p,noHeader:p},H=Symbol("BottomSheet");function T(){const o=t.ref(-1);let i=0;const r={activeSheet:o,id:()=>++i};return{install(m){m.provide(H,r)}}}function P(){return t.inject(H)}function Y(o,i){return t.withModifiers(o,i)}const M=t.defineComponent({name:"SheetRenderer",props:{...B,id:{type:Number,required:!0}},emits:{updateElement:null,close:null},setup(o,{emit:i,slots:r}){const m=P(),n=t.ref(null);t.onUnmounted(()=>i("updateElement",null)),t.onUpdated(()=>{h()});let v=!0;const S=Y(()=>{o.noClickOutside||!v||i("close")},["self"]),d=t.ref(!1),s=t.ref(0),u=t.ref(0);let l=!1,c=0;function h(){c=n.value.getBoundingClientRect().height}function g(){var e,a;(e=n.value)==null||e.style.removeProperty("height"),(a=n.value)==null||a.style.removeProperty("max-height"),c=0,d.value=!1,s.value=0,u.value=0}function f(e){if(!l)return;let a;if("touches"in e?(a=e.touches[0].clientY,e.preventDefault()):a=e.clientY,a===u.value){d.value=!1;return}d.value=!0,s.value=a-u.value,v=!1,s.value<0&&!o.noStretch?(n.value.style.setProperty("height",`${c+Math.abs(s.value)}px`),n.value.style.setProperty("max-height","none")):(n.value.style.removeProperty("height"),n.value.style.removeProperty("max-height"))}function w(e){e.target instanceof HTMLElement&&e.target.closest(`[${x}]`)||("touches"in e?u.value=e.touches[0].clientY:u.value=e.clientY,l=!0)}function b(){!l||(s.value>=o.threshold?i("close"):setTimeout(()=>{var y;v=!0;const e=n.value?n.value.getBoundingClientRect().height:0,a=(y=n.value)==null?void 0:y.animate([{height:`${e}px`},{height:`${c}px`}],{duration:200,easing:"ease"});a==null||a.addEventListener("finish",()=>{n.value&&(n.value.style.removeProperty("height"),n.value.style.removeProperty("max-height"))})}),d.value=!1,u.value=0,s.value=0,l=!1)}function C(e){o.onlyHeaderSwipe&&w(e)}function E(e){o.onlyHeaderSwipe||w(e)}const k=[["resize",g],["resize",h],["mousemove",f],["mouseup",b],["touchend",b],["touchcancel",b],["touchmove",f,{passive:!1}]];return t.onMounted(()=>{h();for(const[e,a,y]of k)window.addEventListener(e,a,y)}),t.onUnmounted(()=>{for(const[e,a]of k)window.removeEventListener(e,a)}),()=>{var e;return t.createVNode("div",{class:"bottom-sheet-backdrop","data-sheet-active":o.id===m.activeSheet.value?"":null,draggable:!1,onClick:S,onMousedown:E,onTouchstart:E},[t.createVNode("div",{ref:n,class:"bottom-sheet","data-swiping":d.value?"":null,style:{transform:`translateY(${Math.max(s.value,0)}px)`}},[o.noHeader?null:t.createVNode("div",{onMousedown:C,onTouchstart:C,class:"bottom-sheet-header"},[r.header?r.header():t.createVNode("div",{class:"bottom-sheet-header-bar"},null)]),t.createVNode("div",{class:"bottom-sheet-body"},[(e=r.default)==null?void 0:e.call(r)])])])}}}),N=t.defineComponent({name:"Sheet",inheritAttrs:!1,props:{...B,visible:{type:Boolean,required:!0}},emits:{"update:visible":null},setup(o,{attrs:i,slots:r,emit:m}){const n=P(),v=n.id();let S=n.activeSheet.value;t.watch(()=>o.visible,l=>{l?(S=n.activeSheet.value,n.activeSheet.value=v):n.activeSheet.value=S},{immediate:!0});function d(){m("update:visible",!1)}function s(l,c){const h=l.querySelector(".bottom-sheet"),g=window.getComputedStyle(l).backgroundColor;l.animate([{backgroundColor:"rgba(0, 0, 0, 0)"},{backgroundColor:g}],{duration:300,easing:"ease"});const f=h.animate([{transform:"translateY(100%)"},{transform:"translateY(0%)"}],{duration:300,easing:"ease"});f.onfinish=c}function u(l,c){const h=l.querySelector(".bottom-sheet"),g=window.getComputedStyle(l).backgroundColor;l.animate([{backgroundColor:g},{backgroundColor:"rgba(0, 0, 0, 0)"}],{duration:300,easing:"ease"});const f=h.animate([{transform:"translateY(0%)"},{transform:"translateY(100%)"}],{duration:300,easing:"ease"});f.onfinish=c}return t.onUnmounted(()=>{n.activeSheet.value=S}),()=>t.createVNode(t.Teleport,{to:"body"},{default:()=>[t.createVNode(t.Transition,{css:!1,onEnter:s,onLeave:u},{default:()=>[o.visible&&t.createVNode(M,t.mergeProps({id:v,onClose:d},i,{noClickOutside:o.noClickOutside,noHeader:o.noHeader,noStretch:o.noStretch,onlyHeaderSwipe:o.onlyHeaderSwipe,threshold:o.threshold}),r)]})]})}});exports.Sheet=N;exports.createBottomSheet=T;
