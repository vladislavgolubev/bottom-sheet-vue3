"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const t=require("vue");const T="data-bottom-sheet-stop",b={type:Boolean,default:!1},B={threshold:{type:Number,default:100},onlyHeaderSwipe:b,noStretch:b,noClickOutside:b,noHeader:b},H=Symbol("BottomSheet");function Y(){const o=t.ref(-1);let l=0;const s={activeSheet:o,id:()=>++l};return{install(g){g.provide(H,s)}}}function M(){return t.inject(H)}function N(o,l){return t.withModifiers(o,l)}const O=t.defineComponent({name:"SheetRenderer",props:{...B,id:{type:Number,required:!0}},emits:{updateElement:null,close:null,swipeChange:null},setup(o,{emit:l,slots:s}){const g=M(),n=t.ref(null),S=t.ref(null);t.onUnmounted(()=>l("updateElement",null));let d=!0;const y=N(()=>{o.noClickOutside||!d||l("close")},["self"]),h=t.ref(!1),r=t.ref(0),u=t.ref(0);let f=!1,a=0,c;function v(){a=n.value.getBoundingClientRect().height}function p(){var e,i;(e=n.value)==null||e.style.removeProperty("height"),(i=n.value)==null||i.style.removeProperty("max-height"),a=0,h.value=!1,r.value=0,u.value=0}function m(e){if(!f)return;let i;if("touches"in e?(i=e.touches[0].clientY,e.preventDefault()):i=e.clientY,i===u.value){h.value=!1;return}h.value=!0,r.value=i-u.value,d=!1,r.value<0&&!o.noStretch?(n.value.style.setProperty("height",`${a+Math.abs(r.value)}px`),n.value.style.setProperty("max-height","none")):(n.value.style.removeProperty("height"),n.value.style.removeProperty("max-height"))}function E(e){e.target instanceof HTMLElement&&e.target.closest(`[${T}]`)||("touches"in e?u.value=e.touches[0].clientY:u.value=e.clientY,f=!0)}function C(){!f||(r.value>=o.threshold?(l("swipeChange",r.value),l("close")):(l("swipeChange",0),setTimeout(()=>{var w;d=!0;const e=n.value?n.value.getBoundingClientRect().height:0,i=(w=n.value)==null?void 0:w.animate([{height:`${e}px`},{height:`${a}px`}],{duration:200,easing:"ease"});i==null||i.addEventListener("finish",()=>{n.value&&(n.value.style.removeProperty("height"),n.value.style.removeProperty("max-height"))})})),h.value=!1,u.value=0,r.value=0,f=!1)}function k(e){o.onlyHeaderSwipe&&E(e)}function x(e){o.onlyHeaderSwipe||E(e)}const P=[["resize",p],["resize",v],["mousemove",m],["mouseup",C],["touchend",C],["touchcancel",C],["touchmove",m,{passive:!1}]];return t.onMounted(()=>{c=new MutationObserver(v),c.observe(S.value,{childList:!0,subtree:!0}),v();for(const[e,i,w]of P)window.addEventListener(e,i,w)}),t.onUnmounted(()=>{for(const[e,i]of P)window.removeEventListener(e,i);c&&c.disconnect()}),()=>{var e;return t.createVNode("div",{class:"bottom-sheet-backdrop","data-sheet-active":o.id===g.activeSheet.value?"":null,draggable:!1,onClick:y,onMousedown:x,onTouchstart:x},[t.createVNode("div",{ref:n,class:"bottom-sheet","data-swiping":h.value?"":null,style:{transform:`translateY(${Math.max(r.value,0)}px)`}},[o.noHeader?null:t.createVNode("div",{onMousedown:k,onTouchstart:k,class:"bottom-sheet-header"},[s.header?s.header():t.createVNode("div",{class:"bottom-sheet-header-bar"},null)]),t.createVNode("div",{class:"bottom-sheet-body",ref:S},[(e=s.default)==null?void 0:e.call(s)])])])}}}),L=t.defineComponent({name:"Sheet",inheritAttrs:!1,props:{...B,visible:{type:Boolean,required:!0}},emits:{"update:visible":null},setup(o,{attrs:l,slots:s,emit:g}){const n=M(),S=n.id();let d=n.activeSheet.value,y=0;t.watch(()=>o.visible,a=>{a?(d=n.activeSheet.value,n.activeSheet.value=S):n.activeSheet.value=d},{immediate:!0});function h(){g("update:visible",!1)}function r(a,c){const v=a.querySelector(".bottom-sheet"),p=window.getComputedStyle(a).backgroundColor;a.animate([{backgroundColor:"rgba(0, 0, 0, 0)"},{backgroundColor:p}],{duration:300,easing:"ease"});const m=v.animate([{transform:"translateY(100%)"},{transform:"translateY(0%)"}],{duration:300,easing:"ease"});m.onfinish=c}function u(a,c){const v=a.querySelector(".bottom-sheet"),p=window.getComputedStyle(a).backgroundColor;a.animate([{backgroundColor:p},{backgroundColor:"rgba(0, 0, 0, 0)"}],{duration:300,easing:"ease"});const m=v.animate([{transform:"translateY("+y.toString()+"px)"},{transform:"translateY(100%)"}],{duration:300,easing:"ease"});m.onfinish=c}function f(a){y=a}return t.onUnmounted(()=>{n.activeSheet.value=d}),()=>t.createVNode(t.Teleport,{to:"body"},{default:()=>[t.createVNode(t.Transition,{css:!1,onEnter:r,onLeave:u},{default:()=>[o.visible&&t.createVNode(O,t.mergeProps({id:S,onClose:h,onSwipeChange:f},l,{noClickOutside:o.noClickOutside,noHeader:o.noHeader,noStretch:o.noStretch,onlyHeaderSwipe:o.onlyHeaderSwipe,threshold:o.threshold}),s)]})]})}});exports.Sheet=L;exports.createBottomSheet=Y;
